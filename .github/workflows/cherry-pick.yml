name: Cherry Pick
on:
  issue_comment:
    types: [created]

env:
  GITHUB_TOKEN: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

jobs:
  cherry-pick:
    name: Cherry Pick
    if: github.event.issue.pull_request != '' && contains(github.event.comment.body, '/cherry-pick')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ env.GITHUB_TOKEN }}
          fetch-depth: 0

      - name: Get event json
        run: |
          cat "${GITHUB_EVENT_PATH}"

      - name: check PR title
        run: |
          PR_TITLE="${{ github.event.issue.pull_request.title }}"
          if [[ "${PR_TITLE}" == "feat"* ]];then
              echo "$(tput -T xterm setaf 1)::error title=Cherry pick feat PR is not allowed! Please submit a PR if you need it. $(tput -T xterm sgr0)"
              exit 1
          fi

      - name: Automatic Cherry Pick
        uses: apecloud-inc/gha-cherry-pick@v1
        env:
          GITHUB_TOKEN: ${{ env.GITHUB_TOKEN }}
